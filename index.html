<!doctype html>
<html lang="fa" dir="rtl">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>کانفیگ‌های V2Ray – IRAN.AZAD</title>

<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:"Vazirmatn",sans-serif}
body{
  min-height:100vh;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#eee;
  padding:2rem 1rem;
  display:flex;flex-direction:column;align-items:center
}

/* ——— هدر ——— */
header{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin-bottom:2rem;
}
.logo{
  width:255px;
  display:block;
  margin-bottom:1.2rem;
}
/* گروه دکمه‌ها */
.btn-group{
  display:flex;
  gap:.8rem;
  flex-wrap:wrap;            /* در موبایل اگر جا نشد، می‌شکند */
  margin-bottom:1.2rem;
}
.btn-download{
  font-size: .65rem;            /* کوچک‌تر از حالت پیش‌فرض (۱rem) */
  padding: .45rem .9rem;        /* قبلاً .7rem 1.4rem بود → ×0.65 */
  background:linear-gradient(90deg,#00c9ff 0%,#92fe9d 100%);
  color:#04252e;
  border:none;border-radius:8px;
  font-weight:700;text-decoration:none;
  transition:filter .2s
}

}
.btn-download:hover{filter:brightness(1.08)}

h1{
  font-size:clamp(1.4rem,4vw,2.2rem);
  margin-top:.6rem;
  text-align:center
}
/* تاریخ */
#datetime{font-size:.8rem;margin-top:.4rem;opacity:.85}

/* متن به‌روزرسانی */
#last-update{
  font-size:.7rem;
  margin-top:.3rem;
  opacity:.7;
  color:#92fe9d;
  text-align:center
}

/* ——— جعبه کانفیگ‌ها ——— */
#box{
  background:#ffffff0d;border:1px solid #ffffff22;
  border-radius:12px;width:100%;max-width:900px;
  padding:1rem;overflow:auto
}
.config-item{
  display:flex;gap:.5rem;align-items:center;
  background:#ffffff12;border:1px solid #ffffff22;
  border-radius:6px;margin-bottom:.6rem;
  padding:.5rem .75rem;direction:ltr;word-break:break-all
}
.config-text{flex:1;font-size:.85rem;line-height:1.4}
.copy-btn{
  padding:.4rem .8rem;border:none;border-radius:4px;
  background:#00c9ff;color:#04252e;font-size:.8rem;font-weight:700;
  cursor:pointer;transition:filter .2s
}
.copy-btn:hover{filter:brightness(1.1)}

footer{margin-top:1.5rem;font-size:.75rem;opacity:.7;text-align:center}

@media(max-width:480px){
  .logo{width:195px}
  .config-text{font-size:.78rem}
  .copy-btn{padding:.3rem .6rem;font-size:.75rem}
}

/* اضافه کردن به بخش استایل */
.utility-btn {
  font-size: 0.65rem;
  padding: 0.45rem 0.9rem;
  background: linear-gradient(90deg, #00c9ff 0%, #92fe9d 100%);
  color: #04252e;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  text-decoration: none;
  transition: filter 0.2s;
  cursor: pointer;
}
.utility-btn:hover {
  filter: brightness(1.08);
}

/* استایل برای مودال آموزش */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
}

.modal-content {
  background: linear-gradient(135deg, #203a43, #2c5364);
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #ffffff22;
  border-radius: 12px;
  width: 80%;
  max-width: 700px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.close-modal {
  color: #aaa;
  float: left;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close-modal:hover {
  color: #fff;
}

.guide-title {
  margin-bottom: 15px;
  font-size: 1.3rem;
  color: #92fe9d;
  text-align: center;
}

.guide-section {
  margin-bottom: 20px;
}

.guide-section h3 {
  font-size: 1.1rem;
  margin-bottom: 10px;
  color: #00c9ff;
}

.guide-section p, .guide-section li {
  font-size: 0.9rem;
  line-height: 1.6;
  margin-bottom: 8px;
}

.guide-section ul {
  padding-right: 20px;
}

.guide-img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin: 10px 0;
  border: 1px solid #ffffff22;
}
</style>

<body>

<header>
  <!-- لوگو -->
  <img src="iran_azad_logo.gif.png" alt="IRAN AZAD logo" class="logo">

  <!-- گروه دکمه‌های دانلود -->
  <div class="btn-group">
    <a class="btn-download" href="https://v2rayn.2dust.link/v2rayN-windows-64-SelfContained.zip" target="_blank" rel="noopener">دانلود ویندوز</a>
    <a class="btn-download" href="https://v2rayng.2dust.link/v2rayNG_1.10.4_arm64-v8a.apk" target="_blank" rel="noopener">دانلود اندروید</a>
    <a class="btn-download" href="https://apps.apple.com/ca/app/shadowrocket/id932747118" target="_blank" rel="noopener noreferrer">دانلود آیفون</a>
  </div>

  <h1>جدیدترین سابسکریپشن‌های&nbsp;V2Ray</h1>
  <div id="datetime">در حال به‌روزرسانی…</div>
  <div id="last-update">در حال بررسی آخرین به‌روزرسانی…</div>
</header>

<div class="utility-buttons" style="margin-bottom: 1rem; display: flex; justify-content: center;">
  <button id="setup-guide" class="utility-btn">آموزش راه‌اندازی</button>
</div>

<div id="box"><div id="loading">در حال بارگیری…</div></div>

<footer> به‌روزرسانی توسط  <strong>© 2025 IRAN.AZAD </strong></footer>

<script>
/* ---------- بارگذاری کانفیگ‌ها ---------- */
// اضافه کردن کد مودال آموزش
document.addEventListener('DOMContentLoaded', function() {
  // دکمه آموزش راه‌اندازی
  const setupGuideBtn = document.getElementById('setup-guide');
  setupGuideBtn.addEventListener('click', showSetupGuide);
  
  // بستن مودال با کلیک روی دکمه بستن
  document.querySelectorAll('.close-modal').forEach(btn => {
    btn.addEventListener('click', hideModal);
  });
  
  // بستن مودال با کلیک خارج از محتوا
  window.addEventListener('click', function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
});

// نمایش مودال آموزش
function showSetupGuide() {
  const modal = document.getElementById('setup-guide-modal');
  modal.style.display = 'block';
}

// مخفی کردن مودال
function hideModal() {
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    modal.style.display = 'none';
  });
}

// به‌روزرسانی تابع fetch برای ذخیره متن کامل کانفیگ‌ها
// این بخش را جایگزین کنید یا تغییر دهید
fetch('https://raw.githubusercontent.com/vpnsaz/IRAN.AZAD/main/subscriptions.txt')
  .then(r => r.text())
  .then(text => {
    const box = document.getElementById('box');
    box.innerHTML = '';
    
    // بررسی اگر فایل با فرمت JSON نیست
    if (text.trim().startsWith('Subscripti') || !text.trim().startsWith('{')) {
      // فرض می‌کنیم هر خط یک URL سابسکریپشن است
      const lines = text.trim().split(/\r?\n/).filter(Boolean);
      
      if (!lines.length) {
        box.textContent = 'فایلی یافت نشد';
        return;
      }
      
      lines.forEach((line, index) => {
        // حذف هرگونه کاراکتر اضافی مثل فاصله یا کامنت
        const url = line.trim();
        
        // اگر خط خالی یا کامنت است، نادیده بگیر
        if (!url || url.startsWith('#')) return;
        
        const item = document.createElement('div');
        item.className = 'subscription-item';
        
        const infoDiv = document.createElement('div');
        infoDiv.className = 'subscription-info';
        
        const nameSpan = document.createElement('div');
        nameSpan.className = 'subscription-name';
        nameSpan.textContent = `سابسکریپشن ${index + 1}`;
        
        const urlSpan = document.createElement('div');
        urlSpan.className = 'subscription-url';
        urlSpan.textContent = url;
        
        infoDiv.appendChild(nameSpan);
        infoDiv.appendChild(urlSpan);
        
        const btn = document.createElement('button');
        btn.className = 'copy-btn';
        btn.textContent = 'Copy';
        btn.onclick = () => {
          navigator.clipboard.writeText(url).then(() => {
            const prev = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = prev, 1500);
          });
        };
        
        item.append(infoDiv, btn);
        box.appendChild(item);
      });
    } else {
      // پردازش به صورت JSON (کد قبلی)
      const lines = text.trim().split(/\r?\n/).filter(Boolean);
      
      lines.forEach(line => {
        try {
          const subData = JSON.parse(line);
          
          const item = document.createElement('div');
          item.className = 'subscription-item';
          
          const infoDiv = document.createElement('div');
          infoDiv.className = 'subscription-info';
          
          const nameSpan = document.createElement('div');
          nameSpan.className = 'subscription-name';
          nameSpan.textContent = subData.name || 'سابسکریپشن';
          
          const urlSpan = document.createElement('div');
          urlSpan.className = 'subscription-url';
          urlSpan.textContent = subData.url;
          
          infoDiv.appendChild(nameSpan);
          infoDiv.appendChild(urlSpan);
          
          if (subData.details) {
            const detailsSpan = document.createElement('div');
            detailsSpan.className = 'subscription-details';
            detailsSpan.textContent = subData.details;
            infoDiv.appendChild(detailsSpan);
          }
          
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.textContent = 'Copy';
          btn.onclick = () => {
            navigator.clipboard.writeText(subData.url).then(() => {
              const prev = btn.textContent;
              btn.textContent = 'Copied!';
              setTimeout(() => btn.textContent = prev, 1500);
            });
          };
          
          item.append(infoDiv, btn);
          box.appendChild(item);
        } catch (e) {
          console.error('خطا در پردازش سابسکریپشن:', e);
        }
      });
    }
    
    // بررسی آخرین به‌روزرسانی فایل
    checkLastUpdate();
  })
  .catch(error => {
    console.error('خطا در بارگیری فایل:', error);
    document.getElementById('box').innerHTML = 'خطا در بارگیری فایل سابسکریپشن‌ها. لطفاً صفحه را رفرش کنید یا بعداً دوباره تلاش کنید.';
  });

/* ---------- بررسی آخرین به‌روزرسانی ---------- */
function checkLastUpdate(){
  try {
    // استفاده از API گیت‌هاب با مدیریت خطا
    fetch('https://api.github.com/repos/vpnsaz/IRAN.AZAD/commits?path=subscriptions.txt&page=1&per_page=1')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        if(data && data.length > 0 && data[0].commit.committer.date){
          const lastModified = data[0].commit.committer.date;
          const fileDate = new Date(lastModified);
          const now = new Date();
          const diffMs = now - fileDate;
          const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
          const diffDays = Math.floor(diffHours / 24);
          
          let updateText = '';
          if(diffDays > 0){
            updateText = `به‌روزرسانی شده ${diffDays} روز قبل`;
          } else if(diffHours > 0){
            updateText = `به‌روزرسانی شده ${diffHours} ساعت قبل`;
          } else {
            const diffMinutes = Math.floor(diffMs / (1000 * 60));
            if(diffMinutes > 0){
              updateText = `به‌روزرسانی شده ${diffMinutes} دقیقه قبل`;
            } else {
              updateText = 'به‌روزرسانی شده همین الان';
            }
          }
          
          document.getElementById('last-update').textContent = updateText;
        } else {
          document.getElementById('last-update').textContent = 'زمان به‌روزرسانی نامشخص';
        }
      })
      .catch(() => {
        // در صورت خطا، تاریخ امروز را نمایش می‌دهیم
        document.getElementById('last-update').textContent = 'به‌روزرسانی شده امروز';
      });
  } catch (e) {
    document.getElementById('last-update').textContent = 'به‌روزرسانی شده امروز';
  }
}

/* ---------- تاریخ و ساعت شمسی ---------- */
function updateDateTime(){
  const now=new Date();
  const opts={calendar:'persian',numberingSystem:'latn',
              hour:'2-digit',minute:'2-digit',second:'2-digit',
              weekday:'long',year:'numeric',month:'long',day:'numeric',
              timeZone:'Asia/Tehran'};
  document.getElementById('datetime').textContent=
    new Intl.DateTimeFormat('fa-IR-u-ca-persian',opts).format(now);
}
updateDateTime(); setInterval(updateDateTime,30000);
</script>

<!-- مودال آموزش راه‌اندازی -->
<div id="setup-guide-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2 class="guide-title">آموزش راه‌اندازی V2Ray</h2>
    
    <div class="guide-section">
      <h3>مرحله ۱: دانلود و نصب نرم‌افزار</h3>
      <p>ابتدا نرم‌افزار مناسب سیستم خود را از لینک‌های بالای صفحه دانلود و نصب کنید:</p>
      <ul>
        <li>برای ویندوز: V2rayN را دانلود و از حالت فشرده خارج و نصب کنید</li>
        <li>برای اندروید: V2rayNG را نصب کنید</li>
        <li>برای آیفون: Shadowrocket را از App Store خریداری و نصب کنید</li>
      </ul>
    </div>
    
    <div class="guide-section">
      <h3>مرحله ۲: اضافه کردن سابسکریپشن</h3>
      <p>برای اضافه کردن سابسکریپشن به نرم‌افزار بعد از اینکه سابسکریپشن مورد نظر را کپی کردید:</p>
      <ul>
        <li>در ویندوز (V2rayN): روی آیکون برنامه در نوار وظیفه راست کلیک کنید → Subscription → Add/Update → لینک سابسکریپشن را وارد کنید → OK</li>
        <li>در اندروید (V2rayNG): روی علامت + کلیک کنید → Import config from clipboard → لینک سابسکریپشن را وارد کنید → OK</li>
        <li>در آیفون (Shadowrocket): روی علامت + کلیک کنید → Type را روی Subscribe قرار دهید → URL سابسکریپشن را وارد کنید → Done</li>
      </ul>
    </div>
    
    <div class="guide-section">
      <h3>مرحله ۳: اتصال به سرور</h3>
      <p><span style="color: #ff5555; font-weight: bold;">پس از اضافه کردن سابسکریپشن روی تاخیر واقعی کانفیگ های گروه کلیک کنید و سپس روی مرتب سازی نتایج کلیک کنید</span></p>
      <ul>
        <li>در ویندوز: روی یکی از سرورها راست کلیک کنید → Set as active server → سپس روی آیکون برنامه راست کلیک کنید و System Proxy را فعال کنید</li>
        <li>در اندروید: روی یکی از سرورها ضربه بزنید تا انتخاب شود → سپس دکمه اتصال (V شکل) را در پایین صفحه لمس کنید</li>
        <li>در آیفون: روی یکی از سرورها ضربه بزنید تا انتخاب شود → سپس دکمه اتصال را در بالای صفحه فعال کنید</li>
      </ul>
    </div>
    
    <div class="guide-section">
      <h3>نکات مهم</h3>
      <ul>
        <li>برای به‌روزرسانی سرورها، در بخش Subscription گزینه Update را انتخاب کنید</li>
        <li>در صورت کند بودن اتصال، سرور دیگری را امتحان کنید</li>
        <li>برای رفع مشکلات احتمالی، نرم‌افزار را به‌روز نگه دارید</li>
      </ul>
    </div>
  </div>
</div>

</body>
</html>
